
## 1. Reconhecimento Inicial

Sempre mudar o user-agent diferente.

### 1.1 Verificação de Host Ativo
```bash

# Syn Scan com modo Stelphy habilitado / testar com g 53/80/443
# se alguma porta só aparecer abera com uma falsificação de porta de origem
# devemos lembrar de fazer uso de ferramentas que permitam definir a origem 
# para se conectar ao serviço, como por ex o nc
nmap -v -D RND:20 -g53 -sS -Pn -p- TARGET_IP

# Scaneamento lento e para poucas portas pode evitar detecção (T2, T1, T0)
nmap -v -sS -Pn --top-ports=10 -T2 TARGET_IP

# verificação completa com scripts
nmap -sVC -p- TARGET_IP

# rodar com UDP
nmap -sUV -sC -p- TARGET_IP

# detectar o sistema operacional
nmap -O TARGET_IP

# Verificação com nmap (detecta mesmo com ICMP bloqueado)
nmap -sn TARGET_IP

# extremamente rapido (gera muito ruido)
nmap -sS -p- --min-rate=60000 TARGET_IP

# Verificação de múltiplos hosts
nmap -sn 192.168.1.0/24 -oG hosts_ativos.txt
grep "Up" hosts_ativos.txt | cut -d " " -f 2 > hosts_up.txt

# mudando o user agent dos scripts do nmap
nmap -p80 --script http-title --script-args http.useragent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) Chrome/120.0" 192.168.0.10

```

### 1.2 Descoberta de Hosts na Rede
```bash
# Network sweeping completo
nmap -sn 192.168.1.0/24 -oG sweep.txt
grep "Up" sweep.txt > hosts_ativos.txt

# Verificação de hosts específicos com serviços web
nmap -sSV -p 80,443 -iL hosts_ativos.txt -Pn --open -oG web_services.txt
```

## 2. Varredura de Portas

### 2.1 Varredura Básica
```bash
# Varredura rápida das portas mais comuns
nmap -F TARGET_IP

# Varredura das top 1000 portas
nmap TARGET_IP

# Varredura de todas as portas (TCP)
nmap -p- TARGET_IP
```

### 2.2 Varredura Stealth (SYN Scan)
```bash
# SYN scan básico
nmap -sS TARGET_IP

# SYN scan com detecção de versão
nmap -sSV TARGET_IP

# SYN scan com OS detection
nmap -sSV -O TARGET_IP
```

### 2.3 Varredura UDP
```bash
# Varredura UDP das portas mais comuns
nmap -sU TARGET_IP

# Varredura UDP com detecção de versão
nmap -sUV TARGET_IP

# Varredura UDP de portas específicas
nmap -sU -p 53,161,500 TARGET_IP
```

### 2.4 Varredura Completa com Scripts
```bash
# Varredura completa com scripts padrão
nmap -sC -sV -O TARGET_IP

# Varredura completa com todos os scripts
nmap -sC -sV -O --script=all TARGET_IP
```

## 3. Evasão de Firewall/IDS

### 3.1 Fragmentação de Pacotes
```bash
# Fragmentação básica
nmap -f TARGET_IP

# Fragmentação com MTU específico
nmap --mtu 24 TARGET_IP
```

### 3.2 Decoy (Spoofing)
```bash
# Decoy com IPs específicos
nmap -D 192.168.1.1,192.168.1.2,192.168.1.3 TARGET_IP

# Decoy com IPs aleatórios
nmap -D RND:10 TARGET_IP

# decoy com porta de origem 53 / testar com portas que aparecem como filtradas
nmap -D RND:30 -g53 -sS -Pn -p- TARGET_IP
```

### 3.3 Source Port Spoofing
```bash
# Usando porta 53 (DNS)
nmap -g 53 TARGET_IP

# Usando porta 80 (HTTP)
nmap -g 80 TARGET_IP
```

### 3.4 Timing e Performance
```bash
# Varredura lenta (T0)
nmap -T0 TARGET_IP

# Varredura rápida (T4)
nmap -T4 TARGET_IP

# Delay entre pacotes
nmap --scan-delay 1000ms TARGET_IP
```

## 4. Detecção de Serviços e Versões

### 4.1 Detecção de Versão
```bash
# Detecção básica de versão
nmap -sV TARGET_IP

# Detecção de versão com trace
nmap -sV --version-trace TARGET_IP
```

### 4.2 Detecção de OS
```bash
# Detecção básica de OS
nmap -O TARGET_IP

# Detecção com guess
nmap -O --osscan-guess TARGET_IP
```

### 4.3 Scripts Específicos por Serviço
```bash
# Scripts para HTTP
nmap --script=http-* TARGET_IP

# Scripts para SMB
nmap --script=smb-* TARGET_IP

# Scripts para SSH
nmap --script=ssh-* TARGET_IP
```

## 5. Varredura de Vulnerabilidades

### 5.1 Scripts de Vulnerabilidade
```bash
# Scripts de vulnerabilidade geral
nmap --script=vuln TARGET_IP

# Scripts específicos por categoria
nmap --script=exploit TARGET_IP
nmap --script=auth TARGET_IP
nmap --script=safe TARGET_IP
```

### 5.2 Varredura com NSE (Nmap Scripting Engine)
```bash
# Listar scripts disponíveis
nmap --script-help all

# Executar script específico
nmap --script=script-name TARGET_IP

# Executar múltiplos scripts
nmap --script=script1,script2,script3 TARGET_IP
```

## 6. Varredura de Redes Internas

### 6.1 Pivoting com Metasploit
```bash
# Dentro do msfconsole
use auxiliary/scanner/portscan/tcp
set RHOSTS 192.168.1.0/24
run

# Adicionar rota para rede interna
route add 192.168.1.0/24 1
```

### 6.2 Varredura através de Proxy
```bash
# Usando proxychains
proxychains nmap -sT TARGET_IP

# Configuração do proxychains
echo "socks4 127.0.0.1 9050" >> /etc/proxychains.conf
```

## 7. Output e Relatórios

### 7.1 Formatos de Saída
```bash
# Saída normal
nmap TARGET_IP -oN scan.txt

# Saída XML
nmap TARGET_IP -oX scan.xml

# Saída grepable
nmap TARGET_IP -oG scan.grep

# Todos os formatos
nmap TARGET_IP -oA scan
```

### 7.2 Verbose e Debug
```bash
# Output verboso
nmap -v TARGET_IP

# Debug mode
nmap -d TARGET_IP

# Packet trace
nmap --packet-trace TARGET_IP
```

## 8. Checklist de Validação

- [ ] Host está ativo e respondendo
- [ ] Portas TCP abertas identificadas
- [ ] Portas UDP abertas identificadas
- [ ] Serviços e versões detectados
- [ ] Sistema operacional identificado
- [ ] Vulnerabilidades conhecidas mapeadas
- [ ] Scripts NSE executados
- [ ] Varredura stealth testada se necessário
- [ ] Rede interna mapeada (se aplicável)

## 11. Dicas Importantes

1. **Sempre usar sudo** para varreduras SYN
2. **Ir captando comandos** e prints de resultados 
3. **Verificar logs** do alvo após varredura
4. **Usar timing apropriado** para evitar detecção
5. **Combinar ferramentas** para validação cruzada
6. **Documentar tudo** para o relatório final
7. **Testar evasão** se necessário
8. **Priorizar portas** baseado no objetivo
